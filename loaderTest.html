<!doctype html>
<html lang="en">
<head>
  <title>Treehouse Logo in three.js</title>
  <meta charset="utf-8">
</head>
<body style="margin: 0;">

    <script src="bower_components/three.js/build/three.js"></script>
    <script src="bower_components/three.js/examples/js/loaders/OBJLoader.js"></script>
    <script src="bower_components/three.js/examples/js/loaders/MTLLoader.js"></script>
    <script src="bower_components/three.js/examples/js/loaders/OBJMTLLoader.js"></script>
    <script src="OrbitControls.js"></script>
    
    <!-- For keyboard controls -->
    <script src="bower_components/THREEx.KeyboardState.js"></script> 
    
    

  <script>
      
    var speed = 2.5;
    var turnSpeed = .02;  
      
    var scene, camera, renderer;
    var keyboard, tank;
    var angle = 0;
      
      var bbox 

    init();
    animate();

/***********************************************************************************************************************
* INIT()
*    Sets up the scene.
*
************************************************************************************************************************/
    function init() {

      // Create the scene and set the scene size.
      scene = new THREE.Scene();
      var WIDTH = window.innerWidth - 5,
          HEIGHT = window.innerHeight - 5;

      // Create a renderer and add it to the DOM.
      renderer = new THREE.WebGLRenderer({antialias:true});
      renderer.setSize(WIDTH, HEIGHT);
      document.body.appendChild(renderer.domElement);

      // Create a camera, zoom it out from the model a bit, and add it to the scene.
      camera = new THREE.PerspectiveCamera(45, WIDTH / HEIGHT, 0.1, 20000);
      camera.position.set(6,0,0);
      //scene.add(camera);

      // Create an event listener that resizes the renderer with the browser window.
      window.addEventListener('resize', function() {
        var WIDTH = window.innerWidth,
            HEIGHT = window.innerHeight;
        renderer.setSize(WIDTH, HEIGHT);
        camera.aspect = WIDTH / HEIGHT;
        camera.updateProjectionMatrix();
      });

      // Set the background color of the scene.
      renderer.setClearColor(0x333F47, 1);

      // Create a light, set its position, and add it to the scene.
      var light = new THREE.PointLight(0xffffff);
      light.position.set(-100,200,100);
    
        scene.add(light);
        

        
        /*******************************************************************
        * Loaders
        *
        *
        ********************************************************************/
        
        // instantiate a loader
        var loader = new THREE.OBJMTLLoader();

        // load an obj / mtl resource pair
        loader.load(
            // OBJ resource URL
            '/CS312/objects/city/city.obj',
            // MTL resource URL
            '/CS312/objects/city/city.mtl',
            // Function when both resources are loaded
            function ( obj ) {
                obj.rotation.x = -Math.PI/2;
                obj.position.y = -666;
                scene.add( obj );
	   },
        // Function called when downloads progress
        function ( xhr ) {
            console.log( (xhr.loaded / xhr.total * 100) + '% loaded' );
        },
        // Function called when downloads error
        function ( xhr ) {
            console.log( 'An error happened' );
        });
        
        
        
        var loader = new THREE.ObjectLoader();
        loader.load("/CS312/objects/tank.json",function ( obj ) {
            obj.position.y = -.4;
            scene.add( obj );
            tank = obj;
            
            bbox = new THREE.BoundingBoxHelper( tank );
            
            
            //Set the camera relative to this object
            tank.add( camera );
            camera.position.set( 0, 5, -25 );
            
            camera.lookAt( new THREE.Vector3( 0, 0, 0 ) );
 
        });      
        
        
        // Add OrbitControls so that we can pan around with the mouse.
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        
        // Set up controls for the keyboard
        keyboard = new THREEx.KeyboardState();    

    }

/****************************************************************************************************************************
*ANITMATE  
*   Renders the scene and updates the render as needed.
*
******************************************************************************************************************************/
    function animate() {

      // Read more about requestAnimationFrame at http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/
      requestAnimationFrame(animate);
      render();
      
    // update camera controls 
    //cameraControls.update();
        
    if(keyboard.pressed("left")) { 
        tank.rotation.y += turnSpeed; 
        angle -= turnSpeed; 
    } 
    if(keyboard.pressed("right")) { 
        tank.rotation.y -= turnSpeed; 
        angle += turnSpeed; 
    } 
    if(keyboard.pressed("up")) { 
        tank.position.x += Math.sin(-angle) * speed; 
        tank.position.z += Math.cos(-angle) * speed; 
    } 
    if(keyboard.pressed("down")) { 
        tank.position.x -= Math.sin(-angle); 
        tank.position.z -= Math.cos(-angle); 
    } 
        
        bbox.update();
        
        
    }
    
/*******************************************************************************************************************************
*Render
*
*
*******************************************************************************************************************************/
    function render() {
        
      renderer.render(scene, camera);
        
    }

  </script>

</body>
</html>



<!--

Put in init

        /* Grass maker */
//        var grassTex = THREE.ImageUtils.loadTexture('images/grass.jpg'); 
//        
//        grassTex.wrapS = THREE.RepeatWrapping; 
//        grassTex.wrapT = THREE.RepeatWrapping; 
//        
//        grassTex.repeat.x = 100; 
//        grassTex.repeat.y = 100; 
//        
//        var groundMat = new THREE.MeshBasicMaterial({map:grassTex});  
//        var groundGeo = new THREE.PlaneGeometry(400,400);  
//        var ground = new THREE.Mesh(groundGeo,groundMat); 
//        
//        ground.rotation.x = -Math.PI/2; // -90 degrees around the xaxis so it's vertical
//        
//        //IMPORTANT, draw on both sides 
//        ground.doubleSided = true; 
//        scene.add(ground); 






var loader = new THREE.ObjectLoader();
        loader.load("/CS312/objects/tank.json",function ( obj ) {
            obj.position.y = -.4;
            scene.add( obj );
            tank = obj;
            
            //Set the camera relative to this object
            tank.add( camera );
            camera.position.set( 0, 5, -25 );
            
            camera.lookAt( new THREE.Vector3( 0, 0, 0 ) );
 
        });   
-->