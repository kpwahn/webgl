<!doctype html>
<html lang="en">
<head>
  <title>Fi Fy Fo Fum</title>
</head>
<body>
    <script src="bower_components/three.js/build/three.js"></script>
    <script src="bower_components/three.js/examples/js/loaders/OBJLoader.js"></script>
    <script src="bower_components/three.js/examples/js/loaders/MTLLoader.js"></script>
    <script src="bower_components/OrbitControls.js"></script>   
    <script src="bower_components/THREEx.KeyboardState.js"></script> 
    
    <script src="js/loadObjects.js"></script>
    <script src="js/keyboard.js"></script>
    <script src="js/advance.js"></script>
    <script src="js/bullet.js"></script>
    <script src="js/loadBullet.js"></script>
    
    <script src="js/parkingGarage.js"></script>
    <script src="js/brickWalls.js"></script>
    
  <script>
    
    //Tank01
    var tank01, tank01Box, tank01BoxDisplay;    
    var tank01Movement = {speed: 1, turnSpeed: .02, driveAngle: 0, shootAngle: 0};
    
    //Tank02  
    var tank02, tank02Box, tank02BoxDisplay;    
    var tank02Movement = {speed: 1, turnSpeed: .02, driveAngle: 0, shootAngle: 0};  

    //Important stuff  
    var scene, camera, camera2, renderer, keyboard;
    var WIDTH, HEIGHT;

    var reload = false; //Should be in the object
    var mainBullet = new loadBullet(); // As well
    var bullet = null;
    var bulletBox = null;
    var bulletAngle = 0;

    init();
    animate();

/***********************************************************************************************************************
* INIT()
*    Sets up the scene.
*
************************************************************************************************************************/
    function init() {

        // Create the scene and set the scene size.
        scene = new THREE.Scene();
        WIDTH = window.innerWidth - 5, HEIGHT = window.innerHeight - 5;

        // Create a renderer and add it to the DOM.
        renderer = new THREE.WebGLRenderer({antialias:true});
        renderer.setSize(WIDTH, HEIGHT);
        renderer.setClearColor(0x333F47, 1);                                    // Set background color of scene
        renderer.autoClear = false;
        document.body.appendChild(renderer.domElement);

        // Create a camera, zoom it out from the model a bit
        camera = new THREE.PerspectiveCamera(45, WIDTH / HEIGHT, 0.1, 20000);
        camera2 = new THREE.PerspectiveCamera(45, WIDTH / HEIGHT, 0.1, 20000);
        
        scene.add(camera2);
        
        // Add OrbitControls so that we can pan around with the mouse.
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls = new THREE.OrbitControls(camera2, renderer.domElement);

        // Create an event listener that resizes the renderer with the browser window.
        window.addEventListener('resize', function() {
        var WIDTH = window.innerWidth,
            HEIGHT = window.innerHeight;
        renderer.setSize(WIDTH, HEIGHT);
        camera.aspect = WIDTH / HEIGHT;
        camera.updateProjectionMatrix();
        });
        
        // Set up controls for the keyboard
        keyboard = new THREEx.KeyboardState();
        
        setUpLight();
        loadObjects();      
        
        scene.add(brickWall);
        scene.add(parkingGarage);
        
        
        
        ///////
        //add ground 
var grassTex = THREE.ImageUtils.loadTexture('images/grass.jpg'); 
grassTex.wrapS = THREE.RepeatWrapping; 
grassTex.wrapT = THREE.RepeatWrapping; 
grassTex.repeat.x = 256; 
grassTex.repeat.y = 256; 
var groundMat = new THREE.MeshBasicMaterial({map:grassTex}); 
        
        var groundGeo = new THREE.PlaneGeometry(1000,1000); 
        
        var ground = new THREE.Mesh(groundGeo,groundMat); 
ground.position.y = -1.9; //lower it 
ground.rotation.x = -Math.PI/2; //-90 degrees around the xaxis 
//IMPORTANT, draw on both sides 
ground.doubleSided = true; 
scene.add(ground); 
    }

/****************************************************************************************************************************
*ANITMATE  
*   Renders the scene and updates the render as needed.
*
******************************************************************************************************************************/
    function animate() {

        requestAnimationFrame(animate);
        render();

        keypress();
        updateBullet(tank01, tank02Box, tank02);
        updateBullet(tank02, tank01Box, tank01);
        advance(tank01);
        advance(tank02);

        tank01Box.setFromObject(tank01);
        tank02Box.setFromObject(tank02);

        //Update just the display box    
        tank01BoxDisplay.update();
    }      
      
/*******************************************************************************************************************************
* Render
*
*
*******************************************************************************************************************************/
    function render() {   
        renderer.clear();    
        renderer.setViewport( 0, 0, WIDTH / 2, HEIGHT);   
        renderer.render( scene, camera);   

        renderer.setViewport( WIDTH / 2, 0, WIDTH / 2, HEIGHT);
        renderer.render( scene, camera2 );
    }

/*******************************************************************************************************************************
* Keyboard
*
*
*******************************************************************************************************************************/
      function keypress() {
        //Tank01
        if(keyboard.pressed("left")) { keyboardLeft(tank02, tank02Box, tank02Movement); } 
        if(keyboard.pressed("right")) { keyboardRight(tank02, tank02Box, tank02Movement); } 
        if(keyboard.pressed("up")) { keyboardUp(tank02, tank02Box, tank02Movement); }
        if(keyboard.pressed("down")) { keyboardDown(tank02, tank02Box, tank02Movement); } 
        if(keyboard.pressed("shift")) { keyboardShoot(tank02, tank02Movement); }
        if(keyboard.pressed("j")) { keyboardA(); }
        if(keyboard.pressed("k")) { keyboardD(); }   
       
    //Tank02      
    if(keyboard.pressed("a")) { keyboardLeft(tank01, tank01Box, tank01Movement); } 
        if(keyboard.pressed("d")) { keyboardRight(tank01, tank01Box, tank01Movement); } 
        if(keyboard.pressed("w")) { keyboardUp(tank01, tank01Box, tank01Movement); }
        if(keyboard.pressed("s")) { keyboardDown(tank01, tank01Box, tank01Movement); } 
        if(keyboard.pressed("f")) { keyboardShoot(tank01, tank01Movement); }      
      }
      
/*******************************************************************************************************************************
* setUpLight
*
*
*******************************************************************************************************************************/
    function setUpLight() {
        var light = new THREE.AmbientLight(0xffffff);
        light.position.set(-100,200,100);
        scene.add(light);   
    }

  </script>

</body>
</html>